
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>账号密码管理器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            padding: 25px;
        }

        h1 {
            color: #1a73e8;
            margin-bottom: 25px;
            text-align: center;
            font-size: 24px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .export-btn, .import-btn {
            padding: 10px 20px;
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .export-btn:hover, .import-btn:hover {
            background-color: #0d66d0;
        }

        .export-json-btn {
            padding: 10px 20px;
            background-color: #34a853;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .export-json-btn:hover {
            background-color: #2d8a46;
        }

        .import-btn {
            background-color: #fbbc05;
        }

        .import-btn:hover {
            background-color: #f5a623;
        }

        #jsonFileInput {
            display: none;
        }

        .add-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .add-form input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }

        .add-form input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .add-form button {
            padding: 12px 20px;
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .add-form button:hover {
            background-color: #0d66d0;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .item {
            display: grid;
            grid-template-columns: 2fr 2fr 1.5fr 1.5fr auto;
            gap: 10px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            align-items: center;
            border: 1px solid #eee;
            position: relative;
        }

        .item span {
            font-size: 14px;
            color: #333;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        /* 标题和网址的截断样式 */
        .item-title, .item-url {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
            position: relative;
        }

        /* 悬停显示完整内容 */
        .item-title:hover::after, 
        .item-url:hover::after {
            content: attr(title);
            position: absolute;
            left: 0;
            bottom: 100%;
            background-color: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
            max-width: 400px;
            overflow: visible;
            text-overflow: clip;
        }

        .item span:hover {
            background-color: #e8eaed;
        }

        .copy-tooltip {
            position: relative;
        }

        .copy-tooltip:hover::before {
            content: '点击复制';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
        }

        /* 设置图标样式 */
        .settings-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #e8eaed;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            color: #5f6368;
            transition: all 0.2s;
            position: relative;
        }

        .settings-icon:hover {
            background-color: #dadce0;
            color: #1a73e8;
        }

        .settings-icon::before {
            content: '⚙️';
        }

        /* 操作按钮容器 */
        .action-buttons {
            display: flex;
            gap: 5px;
            position: absolute;
            right: 45px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .action-buttons.show {
            opacity: 1;
            visibility: visible;
        }

        .edit-btn, .delete-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }

        .edit-btn {
            background-color: #4285f4;
            color: white;
            margin-right: 5px;
        }

        .edit-btn:hover {
            background-color: #1a73e8;
        }

        .delete-btn {
            background-color: #ea4335;
            color: white;
        }

        .delete-btn:hover {
            background-color: #d93025;
        }

        .empty-tip {
            text-align: center;
            color: #777;
            padding: 40px 20px;
            font-size: 14px;
            border: 1px dashed #ddd;
            border-radius: 6px;
            margin-top: 20px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 14px;
            color: white;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .copy-toast {
            background-color: #34a853;
        }

        .export-toast {
            background-color: #1a73e8;
        }

        .json-toast {
            background-color: #34a853;
        }

        .import-toast {
            background-color: #fbbc05;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .edit-modal {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .edit-modal h2 {
            color: #1a73e8;
            margin-bottom: 20px;
            font-size: 18px;
            text-align: center;
        }

        .edit-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .edit-form input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }

        .edit-form input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            flex: 1;
        }

        .save-btn {
            background-color: #1a73e8;
            color: white;
        }

        .save-btn:hover {
            background-color: #0d66d0;
        }

        .cancel-btn {
            background-color: #eee;
            color: #333;
        }

        .cancel-btn:hover {
            background-color: #ddd;
        }

        @media (max-width: 768px) {
            .item {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 15px 15px 25px;
            }
            
            .item-title, .item-url {
                white-space: normal;
                overflow: hidden;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                text-overflow: ellipsis;
            }
            
            .action-buttons {
                position: absolute;
                right: 15px;
                bottom: 10px;
                top: auto;
                transform: none;
            }
            
            .settings-icon {
                position: absolute;
                right: 15px;
                bottom: 10px;
            }
            
            .add-form {
                grid-template-columns: 1fr;
            }
            
            .header-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .export-btn, .export-json-btn, .import-btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>账号密码管理器</h1>
        
        <div class="header-actions">
            <button class="export-btn" id="exportBtn">导出为HTML</button>
            <button class="export-json-btn" id="exportJsonBtn">导出为JSON</button>
            <button class="import-btn" id="importBtn">导入JSON</button>
            <input type="file" id="jsonFileInput" accept=".json">
        </div>
        
        <form class="add-form" id="addForm">
            <input type="text" id="titleInput" placeholder="网页标题（如百度）" required>
            <input type="url" id="urlInput" placeholder="网址（如https://example.com）" required>
            <input type="text" id="usernameInput" placeholder="账号/用户名" required>
            <input type="text" id="passwordInput" placeholder="密码" required>
            <button type="submit">添加条目</button>
        </form>

        <div class="item-list" id="itemList">
            <div class="empty-tip">暂无保存的条目，添加一个吧！</div>
        </div>
    </div>

    <!-- 编辑模态框 -->
    <div class="modal-overlay" id="editModal">
        <div class="edit-modal">
            <h2>编辑条目</h2>
            <form class="edit-form" id="editForm">
                <input type="hidden" id="editItemId">
                <input type="text" id="editTitleInput" placeholder="网页标题（如百度）" required>
                <input type="url" id="editUrlInput" placeholder="网址（如https://example.com）" required>
                <input type="text" id="editUsernameInput" placeholder="账号/用户名" required>
                <input type="text" id="editPasswordInput" placeholder="密码" required>
                <div class="modal-actions">
                    <button type="submit" class="save-btn">保存修改</button>
                    <button type="button" class="cancel-btn" id="cancelEditBtn">取消</button>
                </div>
            </form>
        </div>
    </div>

    <div class="toast copy-toast" id="copyToast">复制成功！</div>
    <div class="toast export-toast" id="exportToast">导出成功！</div>
    <div class="toast json-toast" id="jsonToast">JSON导出成功！</div>
    <div class="toast import-toast" id="importToast">导入成功！</div>

    <script>
        // DOM元素获取
        var addForm = document.getElementById('addForm');
        var titleInput = document.getElementById('titleInput');
        var urlInput = document.getElementById('urlInput');
        var usernameInput = document.getElementById('usernameInput');
        var passwordInput = document.getElementById('passwordInput');
        var itemList = document.getElementById('itemList');
        var copyToast = document.getElementById('copyToast');
        var exportToast = document.getElementById('exportToast');
        var jsonToast = document.getElementById('jsonToast');
        var importToast = document.getElementById('importToast');
        var exportBtn = document.getElementById('exportBtn');
        var exportJsonBtn = document.getElementById('exportJsonBtn');
        var importBtn = document.getElementById('importBtn');
        var jsonFileInput = document.getElementById('jsonFileInput');
        var editModal = document.getElementById('editModal');
        var editForm = document.getElementById('editForm');
        var editItemId = document.getElementById('editItemId');
        var editTitleInput = document.getElementById('editTitleInput');
        var editUrlInput = document.getElementById('editUrlInput');
        var editUsernameInput = document.getElementById('editUsernameInput');
        var editPasswordInput = document.getElementById('editPasswordInput');
        var cancelEditBtn = document.getElementById('cancelEditBtn');

        // 从本地存储加载数据
        var items = JSON.parse(localStorage.getItem('passwordManagerItems')) || [];
        // 记录当前打开设置的条目ID
        var activeSettingsId = null;

        // 初始化页面
        function init() {
            renderItems();
            addForm.onsubmit = handleFormSubmit;
            exportBtn.onclick = exportToHtml;
            exportJsonBtn.onclick = exportToJson;
            importBtn.onclick = function() { jsonFileInput.click(); };
            jsonFileInput.onchange = handleJsonImport;
            editForm.onsubmit = handleEditSubmit;
            cancelEditBtn.onclick = function() { editModal.classList.remove('show'); };
            
            // 点击页面空白处关闭设置菜单
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.item') && activeSettingsId !== null) {
                    hideActionButtons(activeSettingsId);
                    activeSettingsId = null;
                }
            });
        }

        // 处理表单提交
        function handleFormSubmit(e) {
            e.preventDefault();
            
            var title = titleInput.value.trim();
            var url = urlInput.value.trim();
            var username = usernameInput.value.trim();
            var password = passwordInput.value.trim();

            if (!title || !url || !username || !password) {
                alert('请填写所有字段！');
                return;
            }

            var newItem = {
                id: Date.now(),
                title: title,
                url: url,
                username: username,
                password: password
            };

            items.unshift(newItem);
            saveItems();
            renderItems();
            addForm.reset();
        }

        // 处理编辑提交
        function handleEditSubmit(e) {
            e.preventDefault();
            
            var id = parseInt(editItemId.value);
            var title = editTitleInput.value.trim();
            var url = editUrlInput.value.trim();
            var username = editUsernameInput.value.trim();
            var password = editPasswordInput.value.trim();

            if (!title || !url || !username || !password) {
                alert('请填写所有字段！');
                return;
            }

            // 查找并更新条目
            var index = items.findIndex(function(item) {
                return item.id === id;
            });

            if (index !== -1) {
                items[index] = {
                    id: id,
                    title: title,
                    url: url,
                    username: username,
                    password: password
                };
                
                saveItems();
                renderItems();
                editModal.classList.remove('show');
            }
        }

        // 打开编辑模态框
        function openEditModal(id) {
            var item = items.find(function(item) {
                return item.id === id;
            });

            if (item) {
                editItemId.value = item.id;
                editTitleInput.value = item.title;
                editUrlInput.value = item.url;
                editUsernameInput.value = item.username;
                editPasswordInput.value = item.password;
                editModal.classList.add('show');
            }
        }

        // 显示操作按钮
        function showActionButtons(id) {
            // 如果有其他打开的设置，先关闭
            if (activeSettingsId !== null && activeSettingsId !== id) {
                hideActionButtons(activeSettingsId);
            }
            
            var actionButtons = document.getElementById('action-buttons-' + id);
            if (actionButtons) {
                actionButtons.classList.add('show');
                activeSettingsId = id;
            }
        }

        // 隐藏操作按钮
        function hideActionButtons(id) {
            var actionButtons = document.getElementById('action-buttons-' + id);
            if (actionButtons) {
                actionButtons.classList.remove('show');
                activeSettingsId = null;
            }
        }

        // 切换操作按钮显示/隐藏
        function toggleActionButtons(id, e) {
            // 阻止事件冒泡，避免触发页面点击事件
            e.stopPropagation();
            
            var actionButtons = document.getElementById('action-buttons-' + id);
            if (actionButtons) {
                if (actionButtons.classList.contains('show')) {
                    hideActionButtons(id);
                } else {
                    showActionButtons(id);
                }
            }
        }

        // 渲染条目列表
        function renderItems() {
            if (items.length === 0) {
                itemList.innerHTML = '<div class="empty-tip">暂无保存的条目，添加一个吧！</div>';
                return;
            }

            itemList.innerHTML = '';
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.dataset.id = item.id;
                
                // 创建各个字段元素
                var titleSpan = document.createElement('span');
                titleSpan.className = 'copy-tooltip item-title';
                titleSpan.dataset.text = item.title;
                titleSpan.title = item.title; // 完整内容用于tooltip
                titleSpan.textContent = item.title;
                
                var urlSpan = document.createElement('span');
                urlSpan.className = 'copy-tooltip item-url';
                urlSpan.dataset.text = item.url;
                urlSpan.title = item.url; // 完整内容用于tooltip
                urlSpan.textContent = item.url;
                
                var usernameSpan = document.createElement('span');
                usernameSpan.className = 'copy-tooltip';
                usernameSpan.dataset.text = item.username;
                usernameSpan.textContent = item.username;
                
                var passwordSpan = document.createElement('span');
                passwordSpan.className = 'copy-tooltip';
                passwordSpan.dataset.text = item.password;
                passwordSpan.textContent = item.password;
                
                // 创建操作按钮容器
                var actionButtons = document.createElement('div');
                actionButtons.className = 'action-buttons';
                actionButtons.id = 'action-buttons-' + item.id;
                
                // 创建编辑按钮
                var editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.dataset.id = item.id;
                editBtn.textContent = '编辑';
                
                // 创建删除按钮
                var deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.dataset.id = item.id;
                deleteBtn.textContent = '删除';
                
                // 创建设置图标
                var settingsIcon = document.createElement('div');
                settingsIcon.className = 'settings-icon';
                settingsIcon.dataset.id = item.id;
                settingsIcon.title = '操作选项';
                
                // 组装操作按钮
                actionButtons.appendChild(editBtn);
                actionButtons.appendChild(deleteBtn);
                
                // 组装元素
                itemElement.appendChild(titleSpan);
                itemElement.appendChild(urlSpan);
                itemElement.appendChild(usernameSpan);
                itemElement.appendChild(passwordSpan);
                itemElement.appendChild(actionButtons);
                itemElement.appendChild(settingsIcon);
                
                // 绑定事件
                titleSpan.onclick = function() { copyToClipboard(this.dataset.text); };
                urlSpan.onclick = function() { copyToClipboard(this.dataset.text); };
                usernameSpan.onclick = function() { copyToClipboard(this.dataset.text); };
                passwordSpan.onclick = function() { copyToClipboard(this.dataset.text); };
                
                // 设置图标点击事件
                settingsIcon.onclick = function(e) {
                    var id = parseInt(this.dataset.id);
                    toggleActionButtons(id, e);
                };
                
                // 编辑按钮点击事件
                editBtn.onclick = function(e) {
                    e.stopPropagation();
                    var id = parseInt(this.dataset.id);
                    openEditModal(id);
                    // 关闭操作按钮
                    hideActionButtons(id);
                    activeSettingsId = null;
                };
                
                // 删除按钮点击事件
                deleteBtn.onclick = function(e) {
                    e.stopPropagation();
                    var id = parseInt(this.dataset.id);
                    if (confirm('确定要删除这条记录吗？删除后无法恢复！')) {
                        items = items.filter(function(item) {
                            return item.id !== id;
                        });
                        saveItems();
                        renderItems();
                    }
                    // 关闭操作按钮
                    hideActionButtons(id);
                    activeSettingsId = null;
                };
                
                itemList.appendChild(itemElement);
            }
        }

        // 处理JSON导入
        function handleJsonImport(e) {
            var file = e.target.files[0];
            if (!file) return;

            if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                alert('请选择有效的JSON文件！');
                return;
            }

            var reader = new FileReader();
            reader.onload = function(event) {
                try {
                    var jsonData = JSON.parse(event.target.result);
                    
                    // 验证JSON结构
                    if (!jsonData.records || !Array.isArray(jsonData.records)) {
                        alert('JSON格式不正确，缺少records数组！');
                        return;
                    }

                    // 导入数据
                    var importedCount = 0;
                    for (var i = 0; i < jsonData.records.length; i++) {
                        var record = jsonData.records[i];
                        if (record.title && record.url && record.username && record.password) {
                            var newItem = {
                                id: Date.now() + i, // 确保ID唯一
                                title: record.title,
                                url: record.url,
                                username: record.username,
                                password: record.password
                            };
                            items.push(newItem);
                            importedCount++;
                        }
                    }

                    if (importedCount > 0) {
                        saveItems();
                        renderItems();
                        showToast(importToast);
                        alert('成功导入 ' + importedCount + ' 条记录！');
                    } else {
                        alert('未找到有效的记录数据！');
                    }

                } catch (error) {
                    alert('JSON解析失败：' + error.message);
                } finally {
                    // 重置文件输入
                    jsonFileInput.value = '';
                }
            };

            reader.readAsText(file);
        }

        // 复制到剪贴板
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                showToast(copyToast);
            }).catch(function(err) {
                alert('复制失败：' + err);
            });
        }

        // 显示提示框
        function showToast(toastElement) {
            toastElement.classList.add('show');
            setTimeout(function() {
                toastElement.classList.remove('show');
            }, 2000);
        }

        // 导出为HTML文件
        function exportToHtml() {
            if (items.length === 0) {
                alert('暂无数据可导出！');
                return;
            }

            // ==== 安全构建导出内容 ====
            // 1. CSS样式部分
            var exportCss = 'body{font-family:Arial;margin:20px;background:#f0f2f5;}.container{max-width:1000px;margin:0 auto;background:white;padding:25px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.08);}h1{color:#1a73e8;text-align:center;margin-bottom:20px;}.item-list{display:flex;flex-direction:column;gap:10px;margin-top:20px;}.item{display:grid;grid-template-columns:2fr 2fr 1.5fr 1.5fr;gap:10px;padding:15px;background:#f8f9fa;border-radius:6px;align-items:center;border:1px solid #eee;}@media (max-width:768px){.item{grid-template-columns:1fr;}}.item span{font-size:14px;color:#333;cursor:pointer;padding:8px;border-radius:4px;word-break:break-all;transition:background-color 0.2s;}.item-title,.item-url{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%;position:relative;}.item-title:hover::after,.item-url:hover::after{content:attr(title);position:absolute;left:0;bottom:100%;background-color:#333;color:white;padding:8px 12px;border-radius:4px;font-size:12px;white-space:nowrap;z-index:100;max-width:400px;overflow:visible;text-overflow:clip;}.item span:hover{background-color:#e8eaed;}.copy-tooltip{position:relative;}.copy-tooltip:hover::before{content:\'点击复制\';position:absolute;top:-30px;left:50%;transform:translateX(-50%);background-color:#333;color:white;padding:5px 10px;border-radius:4px;font-size:12px;white-space:nowrap;z-index:100;}.info{text-align:center;color:#666;margin-bottom:20px;}.toast{position:fixed;bottom:20px;right:20px;padding:12px 20px;border-radius:4px;font-size:14px;color:white;opacity:0;transform:translateY(20px);transition:all 0.3s ease;z-index:1000;background-color:#34a853;}.toast.show{opacity:1;transform:translateY(0);}';
            
            // 2. HTML头部+样式
            var htmlHead = '<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>账号密码备份-' + new Date().toLocaleString() + '</title><style>' + exportCss + '</style></head><body><div class="container"><h1>账号密码备份</h1><div class="info">导出时间：' + new Date().toLocaleString() + '<br>共' + items.length + '条记录</div><div class="item-list">';
            
            // 3. 数据内容
            var htmlBody = '';
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                htmlBody += '<div class="item"><span class="copy-tooltip item-title" title="' + escapeHtml(item.title) + '" data-text="' + escapeHtml(item.title) + '">' + escapeHtml(item.title) + '</span><span class="copy-tooltip item-url" title="' + escapeHtml(item.url) + '" data-text="' + escapeHtml(item.url) + '">' + escapeHtml(item.url) + '</span><span class="copy-tooltip" data-text="' + escapeHtml(item.username) + '">' + escapeHtml(item.username) + '</span><span class="copy-tooltip" data-text="' + escapeHtml(item.password) + '">' + escapeHtml(item.password) + '</span></div>';
            }
            
            // 4. JS功能部分
            var exportJs = '<script>function copyToClipboard(text){navigator.clipboard.writeText(text).then(function(){var toast=document.getElementById("copyToast");toast.classList.add("show");setTimeout(function(){toast.classList.remove("show");},2000);}).catch(function(err){alert("复制失败："+err);});}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".copy-tooltip").forEach(function(el){el.addEventListener("click",function(){copyToClipboard(this.dataset.text);});});});<\/script>';
            
            // 5. HTML尾部
            var htmlFoot = '</div></div><div class="toast" id="copyToast">复制成功！</div>' + exportJs + '</body></html>';
            
            // 拼接完整内容
            var exportHtml = htmlHead + htmlBody + htmlFoot;

            // 创建下载链接
            try {
                var blob = new Blob([exportHtml], { type: 'text/html;charset=utf-8' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = '账号密码备份_' + new Date().toLocaleDateString().replace(/\//g, '-') + '.html';
                document.body.appendChild(a);
                a.click();
                setTimeout(function() {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                showToast(exportToast);
            } catch (e) {
                alert('导出失败：' + e.message);
            }
        }

        // 导出为JSON文件
        function exportToJson() {
            if (items.length === 0) {
                alert('暂无数据可导出！');
                return;
            }

            // 准备JSON数据（只包含需要的字段）
            var jsonData = {
                exportTime: new Date().toLocaleString(),
                totalCount: items.length,
                records: items.map(function(item) {
                    return {
                        title: item.title,
                        url: item.url,
                        username: item.username,
                        password: item.password
                    };
                })
            };

            // 转换为格式化的JSON字符串
            var jsonString = JSON.stringify(jsonData, null, 2);

            // 创建下载链接
            try {
                var blob = new Blob([jsonString], { type: 'application/json;charset=utf-8' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = '账号密码备份_' + new Date().toLocaleDateString().replace(/\//g, '-') + '.json';
                document.body.appendChild(a);
                a.click();
                setTimeout(function() {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                showToast(jsonToast);
            } catch (e) {
                alert('JSON导出失败：' + e.message);
            }
        }

        // HTML转义工具
        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, '&amp;')
                       .replace(/</g, '&lt;')
                       .replace(/>/g, '&gt;')
                       .replace(/"/g, '&quot;')
                       .replace(/'/g, '&#039;');
        }

        // 保存到本地存储
        function saveItems() {
            localStorage.setItem('passwordManagerItems', JSON.stringify(items));
        }

        // 初始化
        window.onload = init;
    </script>
</body>
</html>
